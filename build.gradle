apply plugin: 'war'
apply plugin: 'java'

war {
    archiveName "pacavaca.war" 
}

repositories {
    mavenCentral()
}

dependencies {
    // https://mvnrepository.com/artifact/commons-io/commons-io
    compile group: 'commons-io', name: 'commons-io', version: '2.4'
    // https://mvnrepository.com/artifact/log4j/log4j
    compile group: 'log4j', name: 'log4j', version: '1.2.17'
}

task buildversion << {
    def versionName = buildversion.split("\\.")
    def last = Integer.parseInt(versionName[versionName.length - 1])
    versionName[versionName.length - 1] = Integer.toString(last + 1)
    versionName = versionName.join(".")
    ant.propertyfile(file: "gradle.properties") {
    entry(key: "buildversion", value: versionName)
    }
}

task greetingfile (dependsOn:check) { 
    doLast{ 
        def gfile = file('/build/resources/main/greeting.txt')
        if (gfile.exists()) gfile.delete()
        def out = new File('build/resources/main/greeting.txt') 
        out << buildversion
        println buildversion
    } 
}

build {
    dependsOn greetingfile
}